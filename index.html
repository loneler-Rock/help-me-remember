<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç§è—åœ°åœ–åµéŒ¯ç‰ˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 100vh; width: 100%; }
        #debug-log { 
            position: absolute; top: 50px; left: 10px; z-index: 9999; 
            background: rgba(0,0,0,0.8); color: #0f0; padding: 10px; 
            font-family: monospace; font-size: 12px; max-width: 90%;
            display: block; pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="debug-log">ğŸš€ ç³»çµ±å•Ÿå‹•ä¸­...</div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <script>
        const log = (msg) => {
            document.getElementById('debug-log').innerHTML += '<br> > ' + msg;
            console.log(msg);
        };

        // â˜…â˜…â˜… è«‹æª¢æŸ¥é€™å…©è¡Œæ˜¯å¦èˆ‡ä½ çš„å¾Œå°ä¸€è‡´ â˜…â˜…â˜…
        const SUPABASE_URL = 'https://eovkimfqgoggxbkvkjxg.supabase.co';
        const SUPABASE_KEY = 'ä½ çš„ANON_KEYè²¼åœ¨é€™é‚Š'; 

        async function start() {
            try {
                const params = new URLSearchParams(window.location.search);
                const uid = params.get('uid');
                log('UID åµæ¸¬: ' + uid);

                if (!uid) {
                    log('âŒ éŒ¯èª¤: ç¶²å€æ²’å¸¶ uid');
                    return;
                }

                log('æ­£åœ¨é€£æ¥ Supabase...');
                const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

                log('æ­£åœ¨è®€å–è³‡æ–™è¡¨ ig_food_map...');
                const { data, error } = await _supabase
                    .from('ig_food_map')
                    .select('*')
                    .eq('user_id', uid);

                if (error) {
                    log('âŒ è³‡æ–™åº«å ±éŒ¯: ' + error.message);
                    return;
                }

                log('æˆåŠŸè®€å–è³‡æ–™ç­†æ•¸: ' + data.length);
                
                const map = L.map('map').setView([23.6, 121], 7);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

                if (data.length > 0) {
                    data.forEach(p => {
                        L.marker([p.latitude, p.longitude]).addTo(map).bindPopup(p.name);
                    });
                    log('âœ… åœ°åœ–æ¨™è¨˜å®Œæˆï¼');
                } else {
                    log('â„¹ï¸ ç›®å‰é€™ ID æ²’è³‡æ–™ï¼Œè«‹å» LINE å‚³é€£çµã€‚');
                }

            } catch (err) {
                log('ğŸ’¥ ç¨‹å¼å…¨é¢å´©æ½°: ' + err.message);
            }
        }

        start();
    </script>
</body>
</html>
