name: Shopping Price Tracker

on:
  # 1. LINE è§¸ç™¼ (åªè½ momo_task)
  repository_dispatch:
    types: [momo_task]
  
  # 2. æ¯æ—¥æ’ç¨‹ (åªåœ¨è³¼ç‰©é€™è®Šè·‘)
  schedule:
    - cron: '0 0 * * *'
    
  # 3. æ‰‹å‹•æŒ‰éˆ•
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          
      # è³¼ç‰©çˆ¬èŸ²éœ€è¦ Chrome (Selenium)
      - name: Setup Chrome
        uses: browser-actions/setup-chrome@latest
          
      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run Shopping Parser
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
        run: |
          # åˆ¤æ–·æ˜¯ LINE å‚³ä¾†çš„ï¼Œé‚„æ˜¯æ’ç¨‹è‡ªå‹•è·‘çš„
          if [ "${{ github.event_name }}" == "repository_dispatch" ]; then
            echo "ğŸ›’ [æ–°å¢æ¨¡å¼] æ”¶åˆ° LINE è³¼ç‰©é€£çµ..."
            python momo_price/main.py "${{ github.event.client_payload.url }}" "${{ github.event.client_payload.user_id }}"
          else
            echo "â° [æƒææ¨¡å¼] åŸ·è¡Œæ¯æ—¥æ¯”åƒ¹..."
            python momo_price/main.py
          fi
